-- Tabela Usuario
CREATE TABLE Usuario (
    UserID INTEGER PRIMARY KEY AUTOINCREMENT,
    UserName TEXT NOT NULL,
    Email TEXT NOT NULL UNIQUE,
    Tipo TEXT NOT NULL CHECK (Tipo IN ('Aluno', 'Professor'))
);

-- Tabela Professor (subclasse de Usuario)
CREATE TABLE Professor (
    UserID INTEGER PRIMARY KEY,
    Diploma TEXT NOT NULL,
    FOREIGN KEY (UserID) REFERENCES Usuario(UserID)
        ON DELETE CASCADE
);

-- Tabela Aluno (subclasse de Usuario)
CREATE TABLE Aluno (
    UserID INTEGER PRIMARY KEY,
    GrauEnsino TEXT NOT NULL,
    FOREIGN KEY (UserID) REFERENCES Usuario(UserID)
        ON DELETE CASCADE
);

-- Tabela Curso
CREATE TABLE Curso (
    CourseID INTEGER PRIMARY KEY AUTOINCREMENT,
    Titulo TEXT NOT NULL
);

-- Tabela Certificado
CREATE TABLE Certificado (
    CertificateID INTEGER PRIMARY KEY AUTOINCREMENT,
    DataConclusao DATE NOT NULL
);

-- Tabela Modulo
CREATE TABLE Modulo (
    CourseID INTEGER NOT NULL,
    Assunto TEXT NOT NULL,
    Nivel TEXT NOT NULL,
    PRIMARY KEY (CourseID, Assunto),
    FOREIGN KEY (CourseID) REFERENCES Curso(CourseID)
        ON DELETE CASCADE
);

-- Tabela Categoria
CREATE TABLE Categoria (
    CategoryID INTEGER PRIMARY KEY AUTOINCREMENT,
    Nome TEXT NOT NULL
);

-- Relação Curso-Participante
CREATE TABLE Relacao_Curso_Participante (
    AlunoID INTEGER NOT NULL,
    CursoID INTEGER NOT NULL,
    ProfessorID INTEGER NOT NULL,
    PRIMARY KEY (AlunoID, CursoID, ProfessorID),
    FOREIGN KEY (AlunoID) REFERENCES Aluno(UserID),
    FOREIGN KEY (CursoID) REFERENCES Curso(CourseID),
    FOREIGN KEY (ProfessorID) REFERENCES Professor(UserID)
);

-- Relação Monitoria
CREATE TABLE Relacao_Monitoria (
    AlunoID INTEGER NOT NULL,
    AlunoMonitorID INTEGER NOT NULL,
    PRIMARY KEY (AlunoID, AlunoMonitorID),
    FOREIGN KEY (AlunoID) REFERENCES Aluno(UserID)
        ON DELETE CASCADE,
    FOREIGN KEY (AlunoMonitorID) REFERENCES Aluno(UserID)
        ON DELETE CASCADE
);

-- Relação Curso-Categoria
CREATE TABLE Relacao_Curso_Categoria (
    CursoID INTEGER NOT NULL,
    CategoriaID INTEGER NOT NULL,
    PRIMARY KEY (CursoID, CategoriaID),
    FOREIGN KEY (CursoID) REFERENCES Curso(CourseID)
        ON DELETE CASCADE,
    FOREIGN KEY (CategoriaID) REFERENCES Categoria(CategoryID)
        ON DELETE CASCADE
);

-- Relação Certificação
CREATE TABLE Relacao_Certificacao (
    CertificadoID INTEGER NOT NULL,
    CursoID INTEGER NOT NULL,
    AlunoID INTEGER NOT NULL,
    PRIMARY KEY (CertificadoID, AlunoID),
    FOREIGN KEY (CertificadoID) REFERENCES Certificado(CertificateID)
        ON DELETE CASCADE,
    FOREIGN KEY (CursoID) REFERENCES Curso(CourseID)
        ON DELETE CASCADE,
    FOREIGN KEY (AlunoID) REFERENCES Aluno(UserID)
        ON DELETE CASCADE
);

-- INSERÇÃO DE DADOS FICTICIOS PARA POPULAR AS TABELAS

-- Inserindo dados na tabela Usuario
INSERT INTO Usuario (UserName, Email, Tipo) VALUES
('Carlos Mendes', 'carlos.mendes@email.com', 'Professor'),
('Julia Lima', 'julia.lima@email.com', 'Aluno'),
('Lucas Souza', 'lucas.souza@email.com', 'Aluno'),
('Mariana Alves', 'mariana.alves@email.com', 'Professor');

-- Inserindo dados na tabela Professor
INSERT INTO Professor (UserID, Diploma) VALUES
(1, 'Mestrado em Ciências da Computação'),
(4, 'Doutorado em Educação Matemática');

-- Inserindo dados na tabela Aluno
INSERT INTO Aluno (UserID, GrauEnsino) VALUES
(2, 'Ensino Superior'),
(3, 'Ensino Médio');

-- Inserindo dados na tabela Curso
INSERT INTO Curso (Titulo) VALUES
('Introdução à Programação'),
('Cálculo Diferencial'),
('História da Matemática');

-- Inserindo dados na tabela Certificado
INSERT INTO Certificado (DataConclusao) VALUES
('2024-03-15'),
('2024-04-10'),
('2024-05-20');

-- Inserindo dados na tabela Modulo
INSERT INTO Modulo (CourseID, Assunto, Nivel) VALUES
(1, 'Lógica de Programação', 'Básico'),
(1, 'Estruturas de Controle', 'Intermediário'),
(2, 'Limites e Derivadas', 'Intermediário'),
(3, 'História Grega e Romana', 'Básico');

-- Inserindo dados na tabela Categoria
INSERT INTO Categoria (Nome) VALUES
('Tecnologia'),
('Matemática'),
('História');

-- Inserindo dados na relação Curso-Participante
INSERT INTO Relacao_Curso_Participante (AlunoID, CursoID, ProfessorID) VALUES
(2, 1, 1),
(3, 2, 4),
(2, 3, 4);

-- Inserindo dados na relação Monitoria
INSERT INTO Relacao_Monitoria (AlunoID, AlunoMonitorID) VALUES
(2, 3);

-- Inserindo dados na relação Curso-Categoria
INSERT INTO Relacao_Curso_Categoria (CursoID, CategoriaID) VALUES
(1, 1),
(2, 2),
(3, 3);

-- Inserindo dados na relação Certificação
INSERT INTO Relacao_Certificacao (CertificadoID, CursoID, AlunoID) VALUES
(1, 1, 2),
(2, 2, 3),
(3, 3, 2);
